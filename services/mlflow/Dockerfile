FROM python:3.9-slim-bullseye

ARG MLFLOW_POSTGRES_USER
ARG MLFLOW_POSTGRES_PASSWORD
ARG MLFLOW_POSTGRES_DB
ARG MLFLOW_S3_ENDPOINT_URL
ARG MINIO_BUCKET_NAME
ARG MINIO_ROOT_USER
ARG MINIO_ROOT_PASSWORD

ENV MLFLOW_POSTGRES_URI="postgresql://${MLFLOW_POSTGRES_USER}:${MLFLOW_POSTGRES_PASSWORD}@mlflow_postgres:5432/${MLFLOW_POSTGRES_DB}"
ENV AWS_ACCESS_KEY_ID=MINIO_ROOT_USER
ENV AWS_SECRET_ACCESS_KEY=MINIO_ROOT_PASSWORD

RUN pip install psycopg2-binary mlflow

ENTRYPOINT mlflow server --host "0.0.0.0" --port "4000" --backend-store-uri $MLFLOW_POSTGRES_URI --default-artifact-root "S3://mlflow" 